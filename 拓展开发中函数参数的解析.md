#拓展开发中函数参数的解析

先行阅读：

1. 《TIPI: 深入理解PHP内核》 第十一章 [扩展开发](http://www.php-internals.com/book/?p=chapt11/11-02-00-extension-hello-world)
2. 《PHP扩展开发及内核应用》 第七章 [函数的参数](https://github.com/walu/phpbook/blob/master/7.md)

##zend\_parse\_parameters

zend\_parse\_parameters是一个ZEND API函数。[定义](https://github.com/php/php-src/blob/master/Zend/zend_API.c#L953-L965)如下：

	ZEND_API int zend_parse_parameters(int num_args, const char *type_spec, ...) /* {{{ */
	{
		va_list va;
		int retval;
		int flags = 0;
	
		va_start(va, type_spec);
		retval = zend_parse_va_args(num_args, type_spec, &va, flags);
		va_end(va);
	
		return retval;
	}
	/* }}} */

第一个参数num_args是指参数个数，可以通过ZEND\_NUM\_ARGS()获取调用函数时传递参数的个数。

第二个参数type_spec是函数期望的各个参数的类型，字符串形式如"sl"、"s|l"。

参考源码理解可作为该参数值的[字符](https://github.com/php/php-src/blob/master/Zend/zend_API.c#L816-L861)。参考源理解各字符所代表的[类型](https://github.com/php/php-src/blob/master/Zend/zend_API.c#L496-L746)。

然后是可变参数，可变参数用于保存函数接受到的参数值。

##Fast Parameter Parsing API
Fast Parameter Parsing API是PHP7定义的新解析参数的方式，效率、易读性都比zend_parse_parameters方式高。具体定义在[这里](https://github.com/php/php-src/blob/master/Zend/zend_API.h#L678-L1047)。例子如下：

	ZEND_PARSE_PARAMETERS_START(1, 2)	//指定最少参数数和最多参数
		Z_PARAM_ZVAL(array)
		Z_PARAM_OPTIONAL				//Z_PARAM_OPTIONAL则表示后面的参数为可选参数
		Z_PARAM_LONG(mode)
	ZEND_PARSE_PARAMETERS_END();

##INTERNAL\_FUNCTION\_PARAMETERS 